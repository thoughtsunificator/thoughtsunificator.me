<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><title>How to save and restore your programs when using i3 | thoughtsunificator.me</title><link href="/main.bundle.css" rel="stylesheet" type="text/css"><link href="/manifest.webmanifest" rel="manifest"></head><body class="wrap"><header id="header"><h1>a boundless expression of thoughts</h1><nav><a href="/">Home</a><a href="/archive/">Archive</a><a href="/tags/">Tags</a><a href="/about/">About</a></nav></header><main id="main"><h2 class="title">How to save and restore your programs when using i3</h2><article class="full post"><div class="metas"><time datetime="2024-04-06T00:00:00.000Z">6 April 2024</time><div class="tags"><a href="/tags/tutorial/" class="tag">#tutorial</a><a href="/tags/i3/" class="tag">#i3</a><a href="/tags/dmenu/" class="tag">#dmenu</a><a href="/tags/i3-resurrect/" class="tag">#i3-resurrect</a></div></div><div id="post-content"><h2 id="introduction" tabindex="-1">Introduction</h2><p>One of the oldest problems I run into with Operating Systems in general, the lower layer of my development environment, is saving/managing my workspace.</p><p>But what does “workspace saving” mean exactly, what am I trying to achieve here?</p><p>I don’t want my OS to be able to restore my windows when I restart, it’s not about that, I can deal with this problem by not rebooting.</p><p>What I want is the ability to to close apps and programs in order to have a clean workspace that contains only what I need at the moment.</p><p>I also want to be able to reopen group of windows at will, to me, these group of windows basically mean the same as a projet. That’s right, a group of windows and their states is a project.</p><p>So how would you go about achieving this? These are the solutions I was able to find :</p><ol><li>Using a (autonomous) solution that means :</li></ol><ul><li>A full-fledged IDE (other than VSCode)</li><li>Paid software at the OS-level (on Windows for the most part)</li></ul><ol start="2"><li>Scripting</li></ol><p>That is what I will be writing about.</p><h3 id="how-to-achieve-workspace-switching-at-the-os-layer-through-scripting" tabindex="-1">How to achieve workspace switching at the os-layer through scripting</h3><p>The first thing I have to think about is the usage.</p><p>I want, through a script, command or whatever, be able to open a specific workspace.</p><p>Something like <code>workspace.sh [project] [feature]</code> for example.</p><p>I have to make a clear distinction between the project and the feature.</p><p>The project is in this case would represent the framework, the basis : the i3 layout, the setup scripts and the programs/scripts themselves.</p><p>The feature could be a specific branch in a git repository for example, or it could be as simple as a parameter that you give to your programs/scripts.</p><h3 id="use-case" tabindex="-1">Use case</h3><p>Let’s say I want to work on a project called <code>foo</code>, on very this project I work simultaneously on 3 separate features.</p><p>The first thing would be that I want to have one terminal, right where the project lives.</p><p>I also want the shell session to start some init. scripts, that could be something like a Python venv for example.</p><p>If I’m working on a Web application I would also need my browser opened up.</p><h3 id="scripting" tabindex="-1">Scripting</h3><h4 id="prerequisites" tabindex="-1">Prerequisites</h4><ul><li>i3</li><li>i3-resurrect</li><li>dmenu</li></ul><h4 id="scripts" tabindex="-1">Scripts</h4><ol><li>Prompt the user for the project it wants to work on.</li><li>Run the main.sh script for the selected project</li></ol><blockquote><p>The script might prompt the user for additional information such as the feature.</p></blockquote><p><code>workspace.sh</code></p><pre class="language-shell"><code class="language-shell"><span class="token important shebang">#!/usr/bin/env sh</span><br><br><span class="token variable assign-left">projects_path</span><span class="token operator">=</span><span class="token string">"<span class="token constant environment">$HOME</span>/.i3/i3-resurrect/projects"</span><br><br><span class="token variable assign-left">project_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token string">"<span class="token variable">$projects_path</span>"</span> <span class="token operator">|</span> dmenu -p project  -i <span class="token operator">|</span> <span class="token function">xargs</span><span class="token variable">)</span></span><br><br><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$project_name</span>"</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>  <span class="token builtin class-name">echo</span> <span class="token string">"Invalid project"</span><br>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><br><span class="token keyword">fi</span><br><br><span class="token variable assign-left">project_path</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$projects_path</span>/<span class="token variable">$project_name</span>"</span><br><span class="token variable assign-left">temp_folder</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>mktemp -d<span class="token variable">)</span></span>"</span><br><span class="token variable assign-left">workspace_number</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>i3-msg -t get_workspaces   <span class="token operator">|</span> jq <span class="token string">'.[] | select(.focused==true).name'</span>   <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">"<span class="token entity" title='\"'>\"</span>"</span> -f2<span class="token variable">)</span></span><br><span class="token variable">$project_path</span>/main.sh <span class="token string">"<span class="token variable">$project_path</span>"</span> <span class="token string">"<span class="token variable">$temp_folder</span>"</span> <span class="token string">"<span class="token variable">$workspace_number</span>"</span> <span class="token operator">&&</span> pipx run i3-resurrect restore -d <span class="token string">"<span class="token variable">$temp_folder</span>"</span> -p current<br><span class="token function">rm</span> -rf <span class="token string">"<span class="token variable">$temp_folder</span>"</span></code></pre><p><code>main.sh</code></p><pre class="language-shell"><code class="language-shell"><span class="token important shebang">#!/usr/bin/env sh</span><br><span class="token variable assign-left">project_path</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span><br><span class="token variable assign-left">temp_folder</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><br><span class="token variable assign-left">workspace_number</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$3</span>"</span><br><span class="token variable assign-left">feature_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> -t /my_project_path/.features <span class="token operator">|</span> dmenu -p Feature -i <span class="token operator">|</span> <span class="token function">xargs</span><span class="token variable">)</span></span> <span class="token comment"># a feature is a folder</span><br><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$feature_name</span>"</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span><br>  <span class="token builtin class-name">echo</span> <span class="token string">"Invalid feature_name"</span><br>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><br><span class="token keyword">fi</span><br><span class="token function">mkdir</span> <span class="token variable">$temp_folder</span>/profiles<br><span class="token function">sed</span> -e <span class="token string">"s/%{feature_name}/<span class="token variable">$feature_name</span>/g"</span> <span class="token string">"<span class="token variable">$project_path</span>/programs.json"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$temp_folder</span>/profiles/current_programs.json"</span> <span class="token operator">&&</span> <span class="token punctuation">\</span> <br><span class="token function">sed</span> -e <span class="token string">"s/%{feature_name}/<span class="token variable">$feature_name</span>/g"</span> <span class="token string">"<span class="token variable">$project_path</span>/layout.json"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$temp_folder</span>/profiles/current_layout.json"</span></code></pre><p><code>programs.json</code></p><blockquote><p>See <a href="https://github.com/JonnyHaystack/i3-resurrect" class="external" rel="noopener noreferrer" target="_blank">https://github.com/JonnyHaystack/i3-resurrect</a></p></blockquote><ul><li>vscode</li><li>firefox</li><li>2 xterm windows</li></ul><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"/opt/visual-studio-code/code"</span><span class="token punctuation">,</span><br>      <span class="token string">"/my_project_path/.features/%{feature_name}/%{feature_name}.code-workspace"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"/my_project_path/.features/%{feature_name}"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"/usr/lib/firefox/firefox"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"$HOME"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"/usr/bin/xterm"</span><span class="token punctuation">,</span><br>			<span class="token string">"-class"</span><span class="token punctuation">,</span><br>      <span class="token string">"UXTerm"</span><span class="token punctuation">,</span><br>      <span class="token string">"-u8"</span><span class="token punctuation">,</span><br>      <span class="token string">"-bw"</span><span class="token punctuation">,</span><br>      <span class="token string">"0"</span><span class="token punctuation">,</span><br>      <span class="token string">"-e"</span><span class="token punctuation">,</span><br>      <span class="token string">"bash --login -i &lt;&lt;&lt; 'source /home/user/.venvs/project/%{feature_name}/bin/activate; exec &lt;/dev/tty'"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"$HOME"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"/usr/bin/xterm"</span><span class="token punctuation">,</span><br>			<span class="token string">"-class"</span><span class="token punctuation">,</span><br>      <span class="token string">"UXTerm"</span><span class="token punctuation">,</span><br>      <span class="token string">"-u8"</span><span class="token punctuation">,</span><br>      <span class="token string">"-bw"</span><span class="token punctuation">,</span><br>      <span class="token string">"0"</span><span class="token punctuation">,</span><br>      <span class="token string">"-e"</span><span class="token punctuation">,</span><br>      <span class="token string">"bash --login -i &lt;&lt;&lt; 'source /home/user/.venvs/project/%{feature_name}/bin/activate; exec &lt;/dev/tty'"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"$HOME"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p><code>layout.json</code> See <a href="https://i3wm.org/docs/layout-saving.html" class="external" rel="noopener noreferrer" target="_blank">https://i3wm.org/docs/layout-saving.html</a></p><hr><p>That’s about it, now you can save and restore your workspaces.</p><p>Thanks for reading.</p></div></article></main><footer id="footer"><small>Built using <a href="https://www.11ty.dev/" target="_blank">Eleventy</a></small> <small class="copyright">© <a href="https://thoughtsunificator.me" target="_blank" rel="author">Romain Lebesle</a></small><div class="icons"><a href="https://twitter.com/thoughtsunifier" target="_blank" rel="noopener" title="Twitter"><img alt="Twitter Profile" src="/image/twitter.svg" width="32"></a><a href="https://github.com/thoughtsunificator" target="_blank" rel="noopener" title="Github"><img alt="View source code on Github" src="/image/github.svg" width="32"></a></div></footer></body></html>