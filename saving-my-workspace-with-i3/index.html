<!doctype html>
<html lang="en">
	<head>
	<!-- A real motherfucking head just like we planned, let see: -->
		<title>How to save and restore your programs when using i3 | thoughtsunificator.me</title>
		<!-- Used mostly for emojis -->
		<meta charset="UTF-8">
		<!-- Because it sucks to read as if you're reading from ten feets away when in reality your smartphone is glued to your face -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- Just a few millions of lines, mostly useless and pathetic "aesthetics" black magick kind of stuff -->
		<link rel="stylesheet" type="text/css" href="/main.css">
		<!-- Used for syntax highlighting inside posts -->
		<link rel="stylesheet" type="text/css" href="/okaida.css">
		<!-- https://w3c.github.io/manifest/ -->
		<link rel="manifest" href="/manifest.webmanifest">
	</head>
	<body class="">
		<main id="main">
			
	<h1 class="title" id="how-to-save-and-restore-your-programs-when-using-i3">How to save and restore your programs when using i3</h1>
	<article class="post full">
		
		<div class="metas">
			
			<time datetime="2024-04-06T00:00:00.000Z">6 April 2024</time>
			<div class="tags">
				<a class="tag" href="/tags/tutorial/">#tutorial</a><a class="tag" href="/tags/i3/">#i3</a><a class="tag" href="/tags/dmenu/">#dmenu</a><a class="tag" href="/tags/i3-resurrect/">#i3-resurrect</a>
			</div>
		</div>
		
		<div id="post-content"><h2 id="introduction">Introduction</h2>
<p>One of the oldest problems I run into with Operating Systems in general, the lower layer of my development environment, is saving/managing my workspace.<br>
But what does &quot;workspace saving&quot; mean exactly, what am I trying to achieve here?</p>
<p>I don't want my OS to be able to restore my windows when I restart, it's not about that, I can deal with this problem by not rebooting. What I want is the ability to to close apps and programs in order to have a clean workspace that contains only what I need at the moment. I also want to be able to reopen group of windows at will, to me, these group of windows basically mean the same as a projet. That's right, a group of windows and their states is a project.</p>
<p>So how would you go about achieving this? These are the solutions I was able to find :</p>
<p><strong>Using a (autonomous) solution that means :</strong></p>
<ul>
<li>A full-fledged IDE (other than VSCode)</li>
<li>Paid software at the OS-level (on Windows for the most part)</li>
</ul>
<p><strong>Scripting</strong></p>
<p>That is what I will be writing about.</p>
<h3 id="how-to-achieve-workspace-switching-at-the-os-layer-through-scripting">How to achieve workspace switching at the os-layer through scripting</h3>
<p>The first thing I have to think about is the usage.
I want, through a script, command or whatever, be able to open a specific workspace.
Something like <code>workspace.sh [project] [feature]</code> for example.</p>
<p>I have to make a clear distinction between the project and the feature.</p>
<p>The project is in this case would represent the framework, the basis : the i3 layout, the setup scripts and the programs/scripts themselves. The feature could be a specific branch in a git repository for example, or it could be as simple as a parameter that you give to your programs/scripts.</p>
<h3 id="use-case">Use case</h3>
<p>Let's say I want to work on a project called <code>foo</code>, on very this project I work simultaneously on 3 separate features. The first thing would be that I want to have one terminal, right where the project lives. I also want the shell session to start some init. scripts, that could be something like a Python venv for example. If I'm working on a Web application I would also need my browser opened up.</p>
<h3 id="scripting">Scripting</h3>
<h4 id="prerequisites">Prerequisites</h4>
<ul>
<li>i3</li>
<li>i3-resurrect</li>
<li>dmenu</li>
</ul>
<h4 id="scripts">Scripts</h4>
<ol>
<li>Prompt the user for the project it wants to work on.</li>
<li>Run the main.sh script for the selected project</li>
</ol>
<blockquote>
<p>The script might prompt the user for additional information such as the feature.</p>
</blockquote>
<p><code>workspace.sh</code></p>
<pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env sh</span>

<span class="token assign-left variable">projects_path</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$HOME</span>/.i3/i3-resurrect/projects"</span>

<span class="token assign-left variable">project_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token string">"<span class="token variable">$projects_path</span>"</span> <span class="token operator">|</span> dmenu <span class="token parameter variable">-p</span> project  <span class="token parameter variable">-i</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token variable">)</span></span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$project_name</span>"</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Invalid project"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">project_path</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$projects_path</span>/<span class="token variable">$project_name</span>"</span>
<span class="token assign-left variable">temp_folder</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>mktemp <span class="token parameter variable">-d</span><span class="token variable">)</span></span>"</span>
<span class="token assign-left variable">workspace_number</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>i3-msg <span class="token parameter variable">-t</span> get_workspaces   <span class="token operator">|</span> jq <span class="token string">'.[] | select(.focused==true).name'</span>   <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">"<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token parameter variable">-f2</span><span class="token variable">)</span></span>
<span class="token variable">$project_path</span>/main.sh <span class="token string">"<span class="token variable">$project_path</span>"</span> <span class="token string">"<span class="token variable">$temp_folder</span>"</span> <span class="token string">"<span class="token variable">$workspace_number</span>"</span> <span class="token operator">&amp;&amp;</span> pipx run i3-resurrect restore <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$temp_folder</span>"</span> <span class="token parameter variable">-p</span> current
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token string">"<span class="token variable">$temp_folder</span>"</span></code></pre>
<p><code>main.sh</code></p>
<pre class="language-shell"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env sh</span>
<span class="token assign-left variable">project_path</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span>
<span class="token assign-left variable">temp_folder</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span>
<span class="token assign-left variable">workspace_number</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$3</span>"</span>
<span class="token assign-left variable">feature_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> <span class="token parameter variable">-t</span> /my_project_path/.features <span class="token operator">|</span> dmenu <span class="token parameter variable">-p</span> Feature <span class="token parameter variable">-i</span> <span class="token operator">|</span> <span class="token function">xargs</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$feature_name</span>"</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Invalid feature_name"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
<span class="token function">mkdir</span> <span class="token variable">$temp_folder</span>/profiles
<span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">"s/%{feature_name}/<span class="token variable">$feature_name</span>/g"</span> <span class="token string">"<span class="token variable">$project_path</span>/programs.json"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$temp_folder</span>/profiles/current_programs.json"</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span> 
<span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">"s/%{feature_name}/<span class="token variable">$feature_name</span>/g"</span> <span class="token string">"<span class="token variable">$project_path</span>/layout.json"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$temp_folder</span>/profiles/current_layout.json"</span></code></pre>
<p><code>programs.json</code></p>
<blockquote>
<p>See https://github.com/JonnyHaystack/i3-resurrect</p>
</blockquote>
<ul>
<li>vscode</li>
<li>firefox</li>
<li>2 xterm windows</li>
</ul>
<pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"/opt/visual-studio-code/code"</span><span class="token punctuation">,</span>
      <span class="token string">"/my_project_path/.features/%{feature_name}/%{feature_name}.code-workspace"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"/my_project_path/.features/%{feature_name}"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"/usr/lib/firefox/firefox"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"$HOME"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"/usr/bin/xterm"</span><span class="token punctuation">,</span>
			<span class="token string">"-class"</span><span class="token punctuation">,</span>
      <span class="token string">"UXTerm"</span><span class="token punctuation">,</span>
      <span class="token string">"-u8"</span><span class="token punctuation">,</span>
      <span class="token string">"-bw"</span><span class="token punctuation">,</span>
      <span class="token string">"0"</span><span class="token punctuation">,</span>
      <span class="token string">"-e"</span><span class="token punctuation">,</span>
      <span class="token string">"bash --login -i &lt;&lt;&lt; 'source /home/user/.venvs/project/%{feature_name}/bin/activate; exec &lt;/dev/tty'"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"$HOME"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"command"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"/usr/bin/xterm"</span><span class="token punctuation">,</span>
			<span class="token string">"-class"</span><span class="token punctuation">,</span>
      <span class="token string">"UXTerm"</span><span class="token punctuation">,</span>
      <span class="token string">"-u8"</span><span class="token punctuation">,</span>
      <span class="token string">"-bw"</span><span class="token punctuation">,</span>
      <span class="token string">"0"</span><span class="token punctuation">,</span>
      <span class="token string">"-e"</span><span class="token punctuation">,</span>
      <span class="token string">"bash --login -i &lt;&lt;&lt; 'source /home/user/.venvs/project/%{feature_name}/bin/activate; exec &lt;/dev/tty'"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"working_directory"</span><span class="token operator">:</span> <span class="token string">"$HOME"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p><code>layout.json</code></p>
<p>After setting up your layout manually you can save it using i3 (see https://i3wm.org/docs/layout-saving.html) or i3-ressurect (see https://github.com/JonnyHaystack/i3-resurrect?tab=readme-ov-file#usage)</p>
<hr>
<p>That's about it, now you can save and restore your workspaces.</p>
<p>Thanks for reading.</p>
</div>
	</article>
		</main>
		<footer id="footer">
			<nav>
				<a href="/">Home</a><a href="/archive/">Archive</a><a href="/tags/">Tags</a><a href="/about/">About</a>
			</nav>
			<span>Built using <a rel="noreferrer" target="_blank" href="https://www.11ty.dev/">Eleventy</a><br>Inspired by <a rel="noreferrer" target="_blank" href="http://motherfuckingwebsite.com">motherfuckingwebsite.com</a></span>
			<span class="tagline">a boundless expression of thoughts</span>
			<div class="icons">
				<a title="Github" target="_blank" rel="noopener" href="https://github.com/thoughtsunificator"><img width="32" alt="View source code on Github" src="/image/github.svg"></a>
			</div>
		</footer>
	</body>
</html>